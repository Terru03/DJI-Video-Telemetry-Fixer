# DJI Mini 3 Pro Telemetry & Metadata Fixer

Recover lost GPS, Date, and Camera settings for DJI Mini 3 Pro videos after editing interactively. This script injects metadata back into your exported videos (MP4/MOV) by reading the original `.SRT` subtitle files generated by the drone.

It is specifically designed to be **Google Photos compatible**, ensuring your videos show up in the correct location and time on the map.

## Features

-   **GPS Injection**: Restores Latitude, Longitude, and Altitude.
-   **Google Photos Ready**: Uses strict ISO 6709 formatting and `Keys` atoms to ensure Google Photos recognizes the location.
-   **Telemetry Subtitles**: Embeds the original `.SRT` flight data (ISO, Shutter, Altitude, etc.) as a soft subtitle track you can toggle on/off.
-   **Camera Settings**: Injects ISO, Shutter Speed, and F-Number into metadata tags.
-   **Smart Processing**: Skips videos that have already been processed to save time on subsequent runs.
-   **Space Saver**: Optional `--delete-source` flag to move bulky original source files to the Recycle Bin after successful processing.

## Prerequisites

1.  **Python 3.6+**: [Download Python](https://www.python.org/downloads/)
2.  **ExifTool**: Required for writing metadata.
    *   [Download ExifTool](https://exiftool.org/)
    *   Make sure `exiftool.exe` is in your system PATH or in the same folder as the script.
3.  **FFmpeg**: Required for embedding subtitle tracks.
    *   [Download FFmpeg](https://ffmpeg.org/download.html)
    *   Make sure `ffmpeg.exe` is in your system PATH.

## Installation

1.  Clone or download this repository.
2.  Ensure you have the prerequisites installed.
3.  Place your exported/edited videos in a folder (e.g., `Exported`).
4.  Ensure you have your original source folder (e.g., `Source`) containing the original `.MP4` and `.SRT` files.

## Usage

1.  Edit `run_injection_template.bat` (Right-click -> Edit).
2.  Set `SOURCE_DIR` to your original DJI folder.
3.  Set `EXPORT_DIR` to your edited videos folder.
4.  Save and double-click the batch file to run!

### Advanced Command Line Usage

```bash
python inject_dji_metadata.py "C:\Path\To\Source" "C:\Path\To\Exports" [options]
```

**Options:**
-   `--force`: Re-process files even if they already appear to have metadata.
-   `--delete-source`: **WARNING**: Moves the original source video file to the Recycle Bin after successful matching and injection. Use this to save disk space after you are sure your exports are good.
-   `--threads 4`: Set the number of parallel processing threads (Default: 4).

## How It Works

1.  **Scans** your Source directory for `.SRT` files.
2.  **Matches** them to videos in your Export directory based on filename (e.g., `DJI_0001.SRT` matches `DJI_0001_Edited.mp4`).
3.  **Embeds** the SRT as a subtitle track using FFmpeg.
4.  **Parses** the SRT for GPS and timestamps.
5.  **Injects** the metadata using ExifTool into `Keys`, `QuickTime`, and `XMP` tags for maximum compatibility.

## License

MIT License. Free to use and modify.
